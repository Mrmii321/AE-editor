<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AE Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous">
    <style>     
        /* Basic Styling for Inputs and Containers */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-image: url(highres.png);
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 140vh;
            color: #ffffff;
        }
        
        .container {
            width: 80%;
            max-width: 900px;
            background-color: #1e1e1e;
            padding: 30px;
            box-shadow: 0 0px 15px rgba(0, 0, 0, 0.5);
            border-radius: 0px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            border-left: solid rgb(255, 0, 144);
            border-right: solid rgb(255, 0, 144);
        }

        h2 {
            text-align: center;
            color: #ffffff;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .form-section {
            display: flex;
            gap: 50px;
        }

        /* Styling for Columns */
        .form-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-column label {
            font-size: 0.85em;
            color: #cccccc;
            margin-bottom: 3px;
        }

        /* Styling for Inputs */
        input, select, textarea {
            background-color: #333;
            color: #ffffff;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
            width: 100%;
            box-sizing: border-box;
            resize: none;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            resize: none;
        }

        /* Button Styling */
        .btn {
            background-color: #444;
            color: #ffffff;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
            font-size: 0.9em;
            border: none;
            transition: background-color 0.3s;
            text-align: center;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #555;
        }

        /* Output Display */
        #output {
            background-color: #1e1e1e;
            border: 1px solid #444;
            padding: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            border-radius: 6px;
            color: #ffffff;
            height: 300px;
            overflow-y: auto;
        }

        /* Popup for Adding Level */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            background-color: #2c2c2c;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
            color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .popup-header {
            font-size: 1.1em;
            margin-bottom: 10px;
            text-align: center;
        }

        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: #888;
            font-size: 1.2em;
        }

        hr {
            border: none;
            border-top: 1px solid #444;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Enchantment Creator</h2>
        
        <div class="form-section">
            <!-- Left Column -->
            <div class="form-column">
                <label for="enchantmentName">Enchantment Name</label>
                <input type="text" id="enchantmentName" placeholder="Enter enchantment name...">

                <label for="enchantmentDescription">Enchantment Description</label>
                <textarea id="enchantmentDescription" placeholder="Enter enchantment description..."></textarea>
                
                <label for="group">Enchantment Group *</label>
                <input type="text" id="group" placeholder="Enter group...">
                <small>* Group sorts enchantments into categories.</small>
            </div>

            <!-- Right Column -->
            <div class="form-column">
                <label for="material">Material</label>
                <select id="material">
                    <option value="">Select Material</option>
                </select>

                <label for="trigger">Enchantment Trigger | Ctrl+Click to choose multiple.</label>
                <select id="trigger" multiple>
                </select>

                <label for="appliesTo">Enchantment Application</label>
                <input type="text" id="appliesTo" placeholder="Enter enchantment applications..." />
                </select>
            </div>
        </div>

        <!-- Add the levelList div here to display levels -->
        <div id="levelList">List of levels</div>

        <!-- Buttons for adding and generating templates -->
        <div class="btn" onclick="showLevelPopup()">New Level</div>
        <div class="btn" onclick="generateTemplate()">Generate Template</div>
        <pre id="output"></pre>
    </div>

    <!-- Popup for Adding/Editing Level -->
    <div id="levelPopup" class="popup">
        <div class="popup-close" onclick="closeLevelPopup()">Ã—</div>
        <div class="popup-header">Edit Level</div>

        <!-- Effect Section -->
        <div>
            <label for="effect">Effect</label>
            <select id="effect" onchange="loadArgsForEffect()">
                <option value="">Select Effect</option>
            </select>
            <div id="argsContainer"></div>
        </div>
        <hr>

        <!-- Target Section -->
        <div>
            <label for="target">Target</label>
            <select id="target" onchange="loadArgsForTarget()">
                <option value="">Select Target</option>
            </select>
            <div id="targetArgsContainer"></div>
        </div>
        <hr>

        <!-- Cooldown and Chance Section -->
        <div>
            <label for="cooldown">Cooldown</label>
            <input type="number" id="cooldown" placeholder="Enter cooldown...">
            
            <label for="chance">Chance</label>
            <input type="number" id="chance" placeholder="Enter chance...">
        </div>

        <div class="btn" id="saveLevelButton" onclick="saveLevel()">Save Level</div>
    </div>

    <script>
        const levels = [];
        let effectsData = {};
        let targetsData = {};

        async function loadTriggers() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/main/advancedenchantments/triggers.json');
            const triggers = await response.json();
            const triggerSelect = document.getElementById("trigger");

            for (const key of Object.keys(triggers)) {
                const option = document.createElement("option");
                option.value = key;
                option.text = key;
                triggerSelect.appendChild(option);
            }
        }

        async function loadTargets() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/main/advancedenchantments/targets.json');
            targetsData = await response.json();
            const targetSelect = document.getElementById("target");

            for (const key in targetsData) {
                const option = document.createElement("option");
                option.value = key;
                option.text = key;
                targetSelect.appendChild(option);
            }
        }

        async function loadMaterials() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/refs/heads/main/advancedenchantments/materials.json');
            const materials = await response.json();
            const materialSelect = document.getElementById("material");

            for (const key in materials) {
                const option = document.createElement("option");
                option.value = key;
                option.text = materials[key];
                materialSelect.appendChild(option);
            }
        }

        async function loadEffects() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/main/advancedenchantments/effects.json');
            effectsData = await response.json();
            const effectSelect = document.getElementById("effect");

            for (const effectKey in effectsData.actions) {
                const option = document.createElement("option");
                option.value = effectsData.actions[effectKey].effect.action;
                option.text = effectKey;
                effectSelect.appendChild(option);
            }
        }

        function loadArgsForEffect() {
            const selectedEffect = document.getElementById("effect").value;
            const argsContainer = document.getElementById("argsContainer");
            argsContainer.innerHTML = "";

            const effectDetails = Object.values(effectsData.actions).find(
                action => action.effect.action === selectedEffect
            );

            if (effectDetails && effectDetails.effect.args) {
                effectDetails.effect.args.forEach(arg => {
                    const label = document.createElement("label");
                    label.textContent = `Argument (${arg}):`;

                    const input = document.createElement("input");
                    input.type = "text";
                    input.id = `arg_${arg}`;
                    input.placeholder = `Enter ${arg}`;

                    const div = document.createElement("div");
                    div.appendChild(label);
                    div.appendChild(input);
                    argsContainer.appendChild(div);
                });
            }
        }

        function loadArgsForTarget() {
            const selectedTarget = document.getElementById("target").value;
            const targetArgsContainer = document.getElementById("targetArgsContainer");
            targetArgsContainer.innerHTML = "";

            const targetDetails = targetsData[selectedTarget];

            if (targetDetails) {
                const usageDiv = document.createElement("div");
                usageDiv.style.marginBottom = "10px";
                usageDiv.style.color = "#aaa";
                usageDiv.innerText = `Usage: ${targetDetails.usage}`;
                targetArgsContainer.appendChild(usageDiv);

                if (targetDetails.usage.includes("{")) {
                    const argsRegex = /{([^}]+)}/g;
                    let match;
                    while ((match = argsRegex.exec(targetDetails.usage)) !== null) {
                        const arg = match[1].split('=')[0].trim();

                        const label = document.createElement("label");
                        label.textContent = `Argument (${arg}):`;

                        const input = document.createElement("input");
                        input.type = "text";
                        input.id = `target_arg_${arg}`;
                        input.placeholder = `Enter ${arg}`;

                        const div = document.createElement("div");
                        div.appendChild(label);
                        div.appendChild(input);
                        targetArgsContainer.appendChild(div);
                    }
                }
            }
        }

        function showLevelPopup() {
            document.getElementById("effect").value = "";
            document.getElementById("target").value = "";
            document.getElementById("cooldown").value = "";
            document.getElementById("chance").value = "";
            document.getElementById("argsContainer").innerHTML = "";
            document.getElementById("targetArgsContainer").innerHTML = "";
            document.getElementById("levelPopup").style.display = "block";

            document.getElementById("saveLevelButton").onclick = saveLevel;
        }

        function closeLevelPopup() {
            document.getElementById("levelPopup").style.display = "none";
        }

        function saveLevel() {
            const effect = document.getElementById("effect").value;
            const target = document.getElementById("target").value;
            const cooldown = document.getElementById("cooldown").value;
            const chance = document.getElementById("chance").value;

            const argsElements = document.querySelectorAll("#argsContainer input");
            let args = Array.from(argsElements)
                .filter(input => input.value.trim() !== "")
                .map(input => `:${input.value}`)
                .join(",");

            const targetArgsElements = document.querySelectorAll("#targetArgsContainer input");
            let targetArgs = Array.from(targetArgsElements)
                .filter(input => input.value.trim() !== "")
                .map(input => `:${input.value}`)
                .join(",");

            const level = { effect, target, args, targetArgs, cooldown, chance };
            levels.push(level);

            updateLevelList();
            closeLevelPopup();
        }

        function deleteLevel(index) {
            if (confirm("Are you sure you want to delete this level?")) {
                levels.splice(index, 1);
                updateLevelList();
            }
        }

        function editLevel(index) {
            const level = levels[index];

            document.getElementById("effect").value = level.effect;
            document.getElementById("target").value = level.target;
            document.getElementById("cooldown").value = level.cooldown;
            document.getElementById("chance").value = level.chance;

            loadArgsForEffect();
            const argsElements = document.querySelectorAll("#argsContainer input");
            const argsValues = level.args.split(",").map(arg => arg.slice(1));
            argsElements.forEach((input, i) => {
                input.value = argsValues[i] || "";
            });

            loadArgsForTarget();
            const targetArgsElements = document.querySelectorAll("#targetArgsContainer input");
            const targetArgsValues = level.targetArgs.split(",").map(arg => arg.slice(1));
            targetArgsElements.forEach((input, i) => {
                input.value = targetArgsValues[i] || "";
            });

            document.getElementById("levelPopup").style.display = "block";
            document.getElementById("saveLevelButton").onclick = function() {
                saveEditedLevel(index);
            };
        }

        function saveEditedLevel(index) {
            const effect = document.getElementById("effect").value;
            const target = document.getElementById("target").value;
            const cooldown = document.getElementById("cooldown").value;
            const chance = document.getElementById("chance").value;

            const argsElements = document.querySelectorAll("#argsContainer input");
            let args = Array.from(argsElements)
                .filter(input => input.value.trim() !== "")
                .map(input => `:${input.value}`)
                .join(",");

            const targetArgsElements = document.querySelectorAll("#targetArgsContainer input");
            let targetArgs = Array.from(targetArgsElements)
                .filter(input => input.value.trim() !== "")
                .map(input => `:${input.value}`)
                .join(",");

            levels[index] = { effect, target, args, targetArgs, cooldown, chance };
            updateLevelList();
            closeLevelPopup();
        }

        function updateLevelList() {
            const levelList = document.getElementById("levelList");

            if (!levelList) {
                console.error("Element with id 'levelList' not found.");
                return;
            }

            levelList.innerHTML = levels.length === 0 ? "List of levels" : "";

            levels.forEach((level, index) => {
                const levelItem = document.createElement("div");
                levelItem.style.display = "inline-flex";  // Ensure buttons and text are in line
                levelItem.style.justifyContent = "flex-start"; // Align buttons to the left
                levelItem.style.alignItems = "center";  // Vertically align items
                levelItem.style.marginBottom = "5px";

                const levelText = document.createElement("span");
                levelText.textContent = `Level ${index + 1}: Effect - ${level.effect}, Target - ${level.target}, Cooldown - ${level.cooldown}s, Chance - ${level.chance}%`;

                const editButton = document.createElement("button");
                editButton.innerHTML = '<i class="fas fa-edit"></i>';
                editButton.style.color = "#5c85ff";
                editButton.style.border = "none";
                editButton.style.background = "transparent";
                editButton.style.cursor = "pointer";
                editButton.style.marginLeft = "5px";  // Reduced margin to bring the buttons closer
                editButton.style.padding = "5px";

                const deleteButton = document.createElement("button");
                deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
                deleteButton.style.color = "#ff5c5c";
                deleteButton.style.border = "none";
                deleteButton.style.background = "transparent";
                deleteButton.style.cursor = "pointer";
                deleteButton.style.marginLeft = "5px";  // Reduced margin to bring the buttons closer
                deleteButton.style.padding = "5px";

                deleteButton.onclick = () => deleteLevel(index);
                editButton.onclick = () => editLevel(index);

                levelItem.appendChild(levelText);
                levelItem.appendChild(editButton);
                levelItem.appendChild(deleteButton);

                levelList.appendChild(levelItem);
            });
        }


        function generateTemplate() {
            const enchantmentName = document.getElementById("enchantmentName").value;
            const enchantmentDescription = document.getElementById("enchantmentDescription").value;
            const group = document.getElementById("group").value;
            const material = document.getElementById("material").value;

            // Handle appliesTo as a text input instead of a select
            const appliesTo = document.getElementById("appliesTo").value.trim();  // Get the typed input value

            const trigger = Array.from(document.getElementById("trigger").selectedOptions)
                .map(opt => opt.value)
                .join(", ");
                
            // Ensure appliesTo is a valid value before continuing
            if (!appliesTo) {
                alert("Please enter enchantment application details.");
                return;  // Stop if appliesTo is empty
            }

            let levelsTemplate = "";
            levels.forEach((level, index) => {
                levelsTemplate += `
        ${index + 1}:
            effects:
                - "${level.effect}${level.args} ${level.target}${level.targetArgs}"
            cooldown: ${level.cooldown}
            chance: ${level.chance}\n`;
            });

    const template = `
${enchantmentName}:
    display: "${enchantmentName}"
    description: "${enchantmentDescription}"
    applies-to: "${appliesTo}"
    type: "${trigger}"
    group: "${group}"
    applies:
        - ${material}
    levels:
${levelsTemplate}`;

    document.getElementById("output").innerText = template;
}


        window.onload = function() {
            loadTriggers();
            loadMaterials();
            loadEffects();
            loadTargets();
        };
    </script>
</body>
</html>
