<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AE Editor</title>
    <style>
        /* Basic Styling for Inputs and Containers */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150vh;
            color: #ffffff;
        }
        
        .container {
            width: 80%;
            max-width: 900px;
            background-color: #1e1e1e;
            padding: 30px;
            box-shadow: 0 0px 15px rgba(0, 0, 0, 0.5);
            border-radius: 0px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        h2 {
            text-align: center;
            color: #ffffff;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .form-section {
            display: flex;
            gap: 20px;
        }

        /* Styling for Columns */
        .form-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-column label {
            font-size: 0.85em;
            color: #cccccc;
            margin-bottom: 3px;
        }

        /* Styling for Inputs */
        input, select, textarea {
            background-color: #333;
            color: #ffffff;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
            width: 100%;
            box-sizing: border-box;
            resize: none;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            resize: none;
        }

        /* Button Styling */
        .btn {
            background-color: #444;
            color: #ffffff;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            border-radius: 4px;
            font-size: 0.9em;
            border: none;
            transition: background-color 0.3s;
            text-align: center;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #555;
        }

        /* Output Display */
        #output {
            background-color: #1e1e1e;
            border: 1px solid #444;
            padding: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            border-radius: 6px;
            color: #ffffff;
            height: 200px;
            overflow-y: auto;
        }

        /* Popup for Adding Level */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            background-color: #2c2c2c;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
            color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .popup-header {
            font-size: 1.1em;
            margin-bottom: 10px;
            text-align: center;
        }

        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: #888;
            font-size: 1.2em;
        }

        .leftLine {
            border-left: 2px solid #ff005d;
            padding: 0.5cm;
        }

        .rightLine {
            border-right: 2px solid #ff005d;
            padding: 0.5cm;
        }


    </style>
</head>
<body>
    <div class="container leftLine rightLine">
        <h2>Enchantment Creator</h2>

        <hr style="width:100%;text-align:left;margin-left:0">
        
        <div class="form-section">
            <!-- Left Column -->
            <div class="form-column">
                <label for="enchantmentName">Enchantment Name</label>
                <input type="text" id="enchantmentName" placeholder="Enter enchantment name...">

                <label for="enchantmentDescription">Enchantment Description</label>
                <textarea id="enchantmentDescription" placeholder="Enter enchantment description..."></textarea>
                
                <label for="group">Enchantment Group *</label>
                <input type="text" id="group" placeholder="Enter group...">
                <small>* Group sorts enchantments into categories.</small>
            </div>

            <!-- Right Column -->
            <div class="form-column">
                <label for="material">Material</label>
                <select id="material">
                    <option value="">Select Material</option>
                </select>

                <label for="trigger">Enchantment Type *</label>
                <select id="trigger" multiple>
                    <option value="EFFECT_STATIC">Effect Static</option>
                    <option value="ATTACK">Attack</option>
                    <option value="DEFENSE">Defense</option>
                    <option value="MINING">Mining</option>
                </select>
                <small>* This changes what causes enchantments to activate.</small>

                <label for="appliesTo">Enchantment Application *</label>
                <select id="appliesTo" multiple>
                    <option value="All Armor">All Armor</option>
                    <option value="All Swords">All Swords</option>
                    <option value="All Axes">All Axes</option>
                </select>
                <small>* Determines what items the enchantment can be applied to.</small>
            </div>
        </div>

        <!-- Add the levelList div here to display levels -->
        <div id="levelList">List of levels</div>

        <!-- Buttons for adding and generating templates -->
        <div class="btn" onclick="showLevelPopup()">New Level</div>
        <div class="btn" onclick="generateTemplate()">Generate Template</div>

        <hr style="width:100%;text-align:left;margin-left:0">

        <pre id="output"></pre>
    </div>

    <!-- Popup for Adding/Editing Level -->
    <div id="levelPopup" class="popup">
        <div class="popup-close" onclick="closeLevelPopup()">Ã—</div>
        <div class="popup-header">Edit Level</div>
        <label for="effect">Effect</label>
        <select id="effect" onchange="loadArgsForEffect()">
            <option value="">Select Effect</option>
        </select>
        <div id="argsContainer"></div>
        <label for="cooldown">Cooldown</label>
        <input type="number" id="cooldown" placeholder="Enter cooldown...">
        <label for="chance">Chance</label>
        <input type="number" id="chance" placeholder="Enter chance...">
        <div class="btn" onclick="saveLevel()">Save Level</div>
    </div>

    <script>
        const levels = [];
        let effectsData = {};

        async function loadTriggers() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/main/advancedenchantments/triggers.json');
            const triggers = await response.json();
            const triggerSelect = document.getElementById("trigger");

            for (const key of Object.keys(triggers)) {
                const option = document.createElement("option");
                option.value = key;
                option.text = key;
                triggerSelect.appendChild(option);
            }
        }

        async function loadAppliesTo() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/main/advancedenchantments/applies.json');
            const appliesTo = await response.json();
            const appliesToSelect = document.getElementById("appliesTo");

            for (const key in appliesTo) {
                const option = document.createElement("option");
                option.value = key;
                option.text = appliesTo[key].formatted;
                appliesToSelect.appendChild(option);
            }
        }

        async function loadMaterials() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/refs/heads/main/advancedenchantments/materials.json');
            const materials = await response.json();
            const materialSelect = document.getElementById("material");

            for (const key in materials) {
                const option = document.createElement("option");
                option.value = key;
                option.text = materials[key];
                materialSelect.appendChild(option);
            }
        }

        async function loadEffects() {
            const response = await fetch('https://raw.githubusercontent.com/AdvancedPlugins/Contributions/main/advancedenchantments/effects.json');
            effectsData = await response.json();
            const effectSelect = document.getElementById("effect");

            for (const effectKey in effectsData.actions) {
                const option = document.createElement("option");
                option.value = effectsData.actions[effectKey].effect.action;
                option.text = effectKey;
                effectSelect.appendChild(option);
            }
        }

        function loadArgsForEffect() {
            const selectedEffect = document.getElementById("effect").value;
            const argsContainer = document.getElementById("argsContainer");
            argsContainer.innerHTML = "";

            const effectDetails = Object.values(effectsData.actions).find(
                action => action.effect.action === selectedEffect
            );

            if (effectDetails && effectDetails.effect.args) {
                effectDetails.effect.args.forEach(arg => {
                    const label = document.createElement("label");
                    label.textContent = `Argument (${arg}):`;

                    const input = document.createElement("input");
                    input.type = "text";
                    input.id = `arg_${arg}`;
                    input.placeholder = `Enter ${arg}`;

                    const div = document.createElement("div");
                    div.appendChild(label);
                    div.appendChild(input);
                    argsContainer.appendChild(div);
                });
            }
        }

        function showLevelPopup() {
            document.getElementById("effect").value = "";
            document.getElementById("cooldown").value = "";
            document.getElementById("chance").value = "";
            document.getElementById("argsContainer").innerHTML = "";
            document.getElementById("levelPopup").style.display = "block";
        }

        function closeLevelPopup() {
            document.getElementById("levelPopup").style.display = "none";
        }

        function saveLevel() {
            const effect = document.getElementById("effect").value;
            const cooldown = document.getElementById("cooldown").value;
            const chance = document.getElementById("chance").value;

            const argsElements = document.querySelectorAll("#argsContainer input");
            let args = Array.from(argsElements)
                .filter(input => input.value.trim() !== "") // Filter out empty inputs
                .map(input => `:${input.value}`) // Prefix each non-empty argument with a colon
                .join(",");

            const level = { effect, args, cooldown, chance };
            levels.push(level);

            updateLevelList();
            closeLevelPopup();
        }

        function updateLevelList() {
            const levelList = document.getElementById("levelList");

            if (!levelList) {
                console.error("Element with id 'levelList' not found.");
                return;
            }

            levelList.innerHTML = levels.length === 0 ? "List of levels" : "";

            levels.forEach((level, index) => {
                const levelItem = document.createElement("div");
                levelItem.textContent = `Level ${index + 1}: Effect - ${level.effect}, Cooldown - ${level.cooldown}s, Chance - ${level.chance}%`;
                levelList.appendChild(levelItem);
            });
        }

        function validateForm() {
            const enchantmentName = document.getElementById("enchantmentName").value.trim();
            const enchantmentDescription = document.getElementById("enchantmentDescription").value.trim();
            const group = document.getElementById("group").value.trim();
            const material = document.getElementById("material").value;
            const trigger = document.getElementById("trigger").selectedOptions;
            const appliesTo = document.getElementById("appliesTo").selectedOptions;

            // Check if all fields have values
            if (!enchantmentName || !enchantmentDescription || !group || !material || trigger.length === 0 || appliesTo.length === 0) {
                alert("Please select all options");
                return false;
            }

            return true;
        }

        function generateTemplate() {
            // Validate form fields before proceeding
            if (!validateForm()) return;

            const enchantmentName = document.getElementById("enchantmentName").value;
            const enchantmentDescription = document.getElementById("enchantmentDescription").value;
            const group = document.getElementById("group").value;
            const material = document.getElementById("material").value;
            const trigger = Array.from(document.getElementById("trigger").selectedOptions).map(opt => opt.value).join(", ");
            const appliesTo = Array.from(document.getElementById("appliesTo").selectedOptions).map(opt => opt.value).join(", ");

            let levelsTemplate = "";
            levels.forEach((level, index) => {
                levelsTemplate += `
            ${index + 1}:
                effects:
                    - "${level.effect}${level.args}"
                cooldown: ${level.cooldown}
                chance: ${level.chance}\n`;
            });

            const template = `
        ${enchantmentName}:
            display: "${enchantmentName}"
            description: "${enchantmentDescription}"
            applies-to: "${appliesTo}"
            type: "${trigger}"
            group: "${group}"
            applies:
                - ${material}
            levels:
        ${levelsTemplate}`;

            document.getElementById("output").innerText = template;
        }


        window.onload = function() {
            loadTriggers();
            loadAppliesTo();
            loadMaterials();
            loadEffects();
        };
    </script>
</body>
</html>
